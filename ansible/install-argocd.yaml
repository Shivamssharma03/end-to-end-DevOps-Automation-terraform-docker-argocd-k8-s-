      kubernetes.core.k8s_info:
        api_version: v1
        kind: Pod
        namespace: argocd
        label_selectors:
          - app.kubernetes.io/name=argocd-server
      register: argocd_pods
      until: argocd_pods.resources | selectattr('status.phase', 'equalto', 'Running') | list | length > 0
      retries: 20
      delay: 15

    - name: Wait until ArgoCD LoadBalancer gets an external IP/DNS
      kubernetes.core.k8s_info:
        api_version: v1
        kind: Service
        name: argocd-server
        namespace: argocd
      register: argocd_svc
      until: >
        argocd_svc.resources
        and argocd_svc.resources[0].status.loadBalancer is defined
        and argocd_svc.resources[0].status.loadBalancer.ingress is defined
        and (argocd_svc.resources[0].status.loadBalancer.ingress[0].hostname is defined
             or argocd_svc.resources[0].status.loadBalancer.ingress[0].ip is defined)
      retries: 20
      delay: 15

    - name: Show ArgoCD public endpoint
      debug:
        msg: >-
          ğŸŒ ArgoCD is ready!
          {{
            argocd_svc.resources[0].status.loadBalancer.ingress[0].hostname
              if argocd_svc.resources[0].status.loadBalancer.ingress[0].hostname is defined
              else argocd_svc.resources[0].status.loadBalancer.ingress[0].ip
          }}